import { __assign, __decorate, __values } from "tslib";
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { NgxCSVParserError } from './_model/ngx-csv-parser-error.interface';
import * as i0 from "@angular/core";
var NgxCsvParser = /** @class */ (function () {
    function NgxCsvParser() {
        this.defaultCSVParserConfig = {
            header: true,
            delimiter: ','
        };
        console.log("\n      *****************************************************\n      ***      For Custom Software/Web development      ***\n      *** Reach out to us at contact@developershive.com ***\n      ***     Visit us at https://developershive.com    ***\n      *****************************************************\n    ");
    }
    NgxCsvParser.prototype.parse = function (csvFile, config) {
        var _this = this;
        config = __assign(__assign({}, this.defaultCSVParserConfig), config);
        var ngxCSVParserObserver = Observable.create(function (observer) {
            try {
                var csvRecords_1 = null;
                if (_this.isCSVFile(csvFile)) {
                    var reader_1 = new FileReader();
                    reader_1.readAsText(csvFile);
                    reader_1.onload = function () {
                        var csvData = reader_1.result;
                        var csvRecordsArray = csvData.trim().split(/\r\n|\n/);
                        var headersRow = _this.getHeaderArray(csvRecordsArray, config);
                        csvRecords_1 = _this.getDataRecordsArrayFromCSVFile(csvRecordsArray, headersRow.length, config);
                        observer.next(csvRecords_1);
                        observer.complete();
                    };
                    reader_1.onerror = function () {
                        _this.badCSVDataFormatErrorHandler(observer);
                    };
                }
                else {
                    _this.notCSVFileErrorHandler(observer);
                }
            }
            catch (error) {
                _this.unknownCSVParserErrorHandler(observer);
            }
        });
        return ngxCSVParserObserver;
    };
    NgxCsvParser.prototype.getDataRecordsArrayFromCSVFile = function (csvRecordsArray, headerLength, config) {
        var dataArr = [];
        var headersArray = csvRecordsArray[0].split(config.delimiter);
        var startingRowToParseData = config.header ? 1 : 0;
        for (var i = startingRowToParseData; i < csvRecordsArray.length; i++) {
            var data = csvRecordsArray[i].split(config.delimiter);
            if (data.length === headerLength && config.header) {
                var csvRecord = {};
                for (var j = 0; j < data.length; j++) {
                    csvRecord[headersArray[j]] = data[j].trim();
                }
                dataArr.push(csvRecord);
            }
            else {
                dataArr.push(data);
            }
        }
        return dataArr;
    };
    NgxCsvParser.prototype.isCSVFile = function (file) {
        return file.name.endsWith('.csv');
    };
    NgxCsvParser.prototype.getHeaderArray = function (csvRecordsArr, config) {
        var e_1, _a;
        var headers = csvRecordsArr[0].split(config.delimiter);
        var headerArray = [];
        try {
            for (var headers_1 = __values(headers), headers_1_1 = headers_1.next(); !headers_1_1.done; headers_1_1 = headers_1.next()) {
                var header = headers_1_1.value;
                headerArray.push(header);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (headers_1_1 && !headers_1_1.done && (_a = headers_1.return)) _a.call(headers_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return headerArray;
    };
    NgxCsvParser.prototype.notCSVFileErrorHandler = function (observer) {
        var ngcCSVParserError = new NgxCSVParserError();
        ngcCSVParserError.type = 'NOT_A_CSV_FILE';
        ngcCSVParserError.message = 'Selected file is not a csv File Type';
        ngcCSVParserError.code = 2;
        observer.error(ngcCSVParserError);
    };
    NgxCsvParser.prototype.unknownCSVParserErrorHandler = function (observer) {
        var ngcCSVParserError = new NgxCSVParserError();
        ngcCSVParserError.type = 'UNKNOWN_ERROR';
        ngcCSVParserError.message = 'Unknown error. Please refer to official documentation for library usage.';
        ngcCSVParserError.code = 404;
        observer.error(ngcCSVParserError);
    };
    NgxCsvParser.prototype.badCSVDataFormatErrorHandler = function (observer) {
        var ngcCSVParserError = new NgxCSVParserError();
        ngcCSVParserError.type = 'BAD_CSV_DATA_FORMAT';
        ngcCSVParserError.message = 'Unable to parse CSV File';
        ngcCSVParserError.code = 1;
        observer.error(ngcCSVParserError);
    };
    NgxCsvParser.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgxCsvParser_Factory() { return new NgxCsvParser(); }, token: NgxCsvParser, providedIn: "root" });
    NgxCsvParser = __decorate([
        Injectable({
            providedIn: 'root'
        })
    ], NgxCsvParser);
    return NgxCsvParser;
}());
export { NgxCsvParser };
var CSVParserConfig = /** @class */ (function () {
    function CSVParserConfig() {
    }
    return CSVParserConfig;
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWNzdi1wYXJzZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1jc3YtcGFyc2VyLyIsInNvdXJjZXMiOlsibGliL25neC1jc3YtcGFyc2VyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQzs7QUFLNUU7SUFFRTtRQVVRLDJCQUFzQixHQUFHO1lBQy9CLE1BQU0sRUFBRSxJQUFJO1lBQ1osU0FBUyxFQUFFLEdBQUc7U0FDZixDQUFDO1FBWkEsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5VEFNWCxDQUFDLENBQUM7SUFDTCxDQUFDO0lBT0QsNEJBQUssR0FBTCxVQUFNLE9BQWEsRUFBRSxNQUF1QjtRQUE1QyxpQkEyQ0M7UUF6Q0MsTUFBTSx5QkFDRCxJQUFJLENBQUMsc0JBQXNCLEdBQzNCLE1BQU0sQ0FDVixDQUFDO1FBRUYsSUFBTSxvQkFBb0IsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLFVBQUMsUUFBa0Q7WUFDaEcsSUFBSTtnQkFFRixJQUFJLFlBQVUsR0FBRyxJQUFJLENBQUM7Z0JBRXRCLElBQUksS0FBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRTtvQkFFM0IsSUFBTSxRQUFNLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztvQkFDaEMsUUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFFM0IsUUFBTSxDQUFDLE1BQU0sR0FBRzt3QkFDZCxJQUFNLE9BQU8sR0FBRyxRQUFNLENBQUMsTUFBTSxDQUFDO3dCQUM5QixJQUFNLGVBQWUsR0FBSSxPQUFrQixDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQzt3QkFFcEUsSUFBTSxVQUFVLEdB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QWlCLENBQUMsSUFBSSxHQUFHLGdCQUFnQixDQUFDO1FBQzFDLGlCQUFpQixDQUFDLE9BQU8sR0FBRyxzQ0FBc0MsQ0FBQztRQUNuRSxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQzNCLFFBQVEsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsbURBQTRCLEdBQTVCLFVBQTZCLFFBQXVCO1FBQ2xELElBQU0saUJBQWlCLEdBQXNCLElBQUksaUJBQWlCLEVBQUUsQ0FBQztRQUNyRSxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsZUFBZSxDQUFDO1FBQ3pDLGlCQUFpQixDQUFDLE9BQU8sR0FBRywwRUFBMEUsQ0FBQztRQUN2RyxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1FBQzdCLFFBQVEsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsbURBQTRCLEdBQTVCLFVBQTZCLFFBQXVCO1FBQ2xELElBQU0saUJBQWlCLEdBQXNCLElBQUksaUJBQWlCLEVBQUUsQ0FBQztRQUNyRSxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcscUJBQXFCLENBQUM7UUFDL0MsaUJBQWlCLENBQUMsT0FBTyxHQUFHLDBCQUEwQixDQUFDO1FBQ3ZELGlCQUFpQixDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDM0IsUUFBUSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7O0lBekhVLFlBQVk7UUFIeEIsVUFBVSxDQUFDO1lBQ1YsVUFBVSxFQUFFLE1BQU07U0FDbkIsQ0FBQztPQUNXLFlBQVksQ0EwSHhCO3VCQWpJRDtDQWlJQyxBQTFIRCxJQTBIQztTQTFIWSxZQUFZO0FBNEh6QjtJQUlFO0lBQWdCLENBQUM7SUFDbkIsc0JBQUM7QUFBRCxDQUFDLEFBTEQsSUFLQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgT2JzZXJ2ZXIgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgTmd4Q1NWUGFyc2VyRXJyb3IgfSBmcm9tICcuL19tb2RlbC9uZ3gtY3N2LXBhcnNlci1lcnJvci5pbnRlcmZhY2UnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTmd4Q3N2UGFyc2VyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7IFxyXG4gICAgY29uc29sZS5sb2coYFxyXG4gICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICAqKiogICAgICBGb3IgQ3VzdG9tIFNvZnR3YXJlL1dlYiBkZXZlbG9wbWVudCAgICAgICoqKlxyXG4gICAgICAqKiogUmVhY2ggb3V0IHRvIHVzIGF0IGNvbnRhY3RAZGV2ZWxvcGVyc2hpdmUuY29tICoqKlxyXG4gICAgICAqKiogICAgIFZpc2l0IHVzIGF0IGh0dHBzOi8vZGV2ZWxvcGVyc2hpdmUuY29tICAgICoqKlxyXG4gICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgYCk7ICAgIFxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZWZhdWx0Q1NWUGFyc2VyQ29uZmlnID0ge1xyXG4gICAgaGVhZGVyOiB0cnVlLFxyXG4gICAgZGVsaW1pdGVyOiAnLCdcclxuICB9O1xyXG5cclxuICBwYXJzZShjc3ZGaWxlOiBGaWxlLCBjb25maWc6IENTVlBhcnNlckNvbmZpZyk6IE9ic2VydmFibGU8QXJyYXk8YW55Pj4ge1xyXG5cclxuICAgIGNvbmZpZyA9IHtcclxuICAgICAgLi4udGhpcy5kZWZhdWx0Q1NWUGFyc2VyQ29uZmlnLFxyXG4gICAgICAuLi5jb25maWdcclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qgbmd4Q1NWUGFyc2VyT2JzZXJ2ZXIgPSBPYnNlcnZhYmxlLmNyZWF0ZSgob2JzZXJ2ZXI6IE9ic2VydmVyPEFycmF5PGFueT4gfCBOZ3hDU1ZQYXJzZXJFcnJvcj4pID0+IHtcclxuICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgbGV0IGNzdlJlY29yZHMgPSBudWxsO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pc0NTVkZpbGUoY3N2RmlsZSkpIHtcclxuXHJcbiAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoY3N2RmlsZSk7XHJcblxyXG4gICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY3N2RGF0YSA9IHJlYWRlci5yZXN1bHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGNzdlJlY29yZHNBcnJheSA9IChjc3ZEYXRhIGFzIHN0cmluZykudHJpbSgpLnNwbGl0KC9cXHJcXG58XFxuLyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzUm93ID0gdGhpcy5nZXRIZWFkZXJBcnJheShjc3ZSZWNvcmRzQXJyYXksIGNvbmZpZyk7XHJcblxyXG4gICAgICAgICAgICBjc3ZSZWNvcmRzID0gdGhpcy5nZXREYXRhUmVjb3Jkc0FycmF5RnJvbUNTVkZpbGUoY3N2UmVjb3Jkc0FycmF5LCBoZWFkZXJzUm93Lmxlbmd0aCwgY29uZmlnKTtcclxuXHJcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQoY3N2UmVjb3Jkcyk7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmJhZENTVkRhdGFGb3JtYXRFcnJvckhhbmRsZXIob2JzZXJ2ZXIpO1xyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubm90Q1NWRmlsZUVycm9ySGFuZGxlcihvYnNlcnZlcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICB0aGlzLnVua25vd25DU1ZQYXJzZXJFcnJvckhhbmRsZXIob2JzZXJ2ZXIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gbmd4Q1NWUGFyc2VyT2JzZXJ2ZXI7XHJcbiAgfVxyXG5cclxuICBnZXREYXRhUmVjb3Jkc0FycmF5RnJvbUNTVkZpbGUoY3N2UmVjb3Jkc0FycmF5OiBhbnksIGhlYWRlckxlbmd0aDogYW55LCBjb25maWc6IGFueSkge1xyXG4gICAgY29uc3QgZGF0YUFyciA9IFtdO1xyXG4gICAgY29uc3QgaGVhZGVyc0FycmF5ID0gKGNzdlJlY29yZHNBcnJheVswXSBhcyBzdHJpbmcpLnNwbGl0KGNvbmZpZy5kZWxpbWl0ZXIpO1xyXG5cclxuICAgIGNvbnN0IHN0YXJ0aW5nUm93VG9QYXJzZURhdGEgPSBjb25maWcuaGVhZGVyID8gMSA6IDA7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0aW5nUm93VG9QYXJzZURhdGE7IGkgPCBjc3ZSZWNvcmRzQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgZGF0YSA9IChjc3ZSZWNvcmRzQXJyYXlbaV0gYXMgc3RyaW5nKS5zcGxpdChjb25maWcuZGVsaW1pdGVyKTtcclxuXHJcbiAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gaGVhZGVyTGVuZ3RoICYmIGNvbmZpZy5oZWFkZXIpIHtcclxuXHJcbiAgICAgICAgY29uc3QgY3N2UmVjb3JkID0ge307XHJcblxyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZGF0YS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgY3N2UmVjb3JkW2hlYWRlcnNBcnJheVtqXV0gPSBkYXRhW2pdLnRyaW0oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGF0YUFyci5wdXNoKGNzdlJlY29yZCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZGF0YUFyci5wdXNoKGRhdGEpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGF0YUFycjtcclxuICB9XHJcblxyXG4gIGlzQ1NWRmlsZShmaWxlOiBhbnkpIHtcclxuICAgIHJldHVybiBmaWxlLm5hbWUuZW5kc1dpdGgoJy5jc3YnKTtcclxuICB9XHJcblxyXG4gIGdldEhlYWRlckFycmF5KGNzdlJlY29yZHNBcnI6IGFueSwgY29uZmlnOiBhbnkpIHtcclxuICAgIGNvbnN0IGhlYWRlcnMgPSAoY3N2UmVjb3Jkc0FyclswXSBhcyBzdHJpbmcpLnNwbGl0KGNvbmZpZy5kZWxpbWl0ZXIpO1xyXG4gICAgY29uc3QgaGVhZGVyQXJyYXkgPSBbXTtcclxuICAgIGZvciAoY29uc3QgaGVhZGVyIG9mIGhlYWRlcnMpIHtcclxuICAgICAgaGVhZGVyQXJyYXkucHVzaChoZWFkZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhlYWRlckFycmF5O1xyXG4gIH1cclxuXHJcbiAgbm90Q1NWRmlsZUVycm9ySGFuZGxlcihvYnNlcnZlcjogT2JzZXJ2ZXI8YW55Pikge1xyXG4gICAgY29uc3QgbmdjQ1NWUGFyc2VyRXJyb3I6IE5neENTVlBhcnNlckVycm9yID0gbmV3IE5neENTVlBhcnNlckVycm9yKCk7XHJcbiAgICBuZ2NDU1ZQYXJzZXJFcnJvci50eXBlID0gJ05PVF9BX0NTVl9GSUxFJztcclxuICAgIG5nY0NTVlBhcnNlckVycm9yLm1lc3NhZ2UgPSAnU2VsZWN0ZWQgZmlsZSBpcyBub3QgYSBjc3YgRmlsZSBUeXBlJztcclxuICAgIG5nY0NTVlBhcnNlckVycm9yLmNvZGUgPSAyO1xyXG4gICAgb2JzZXJ2ZXIuZXJyb3IobmdjQ1NWUGFyc2VyRXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgdW5rbm93bkNTVlBhcnNlckVycm9ySGFuZGxlcihvYnNlcnZlcjogT2JzZXJ2ZXI8YW55Pikge1xyXG4gICAgY29uc3QgbmdjQ1NWUGFyc2VyRXJyb3I6IE5neENTVlBhcnNlckVycm9yID0gbmV3IE5neENTVlBhcnNlckVycm9yKCk7XHJcbiAgICBuZ2NDU1ZQYXJzZXJFcnJvci50eXBlID0gJ1VOS05PV05fRVJST1InO1xyXG4gICAgbmdjQ1NWUGFyc2VyRXJyb3IubWVzc2FnZSA9ICdVbmtub3duIGVycm9yLiBQbGVhc2UgcmVmZXIgdG8gb2ZmaWNpYWwgZG9jdW1lbnRhdGlvbiBmb3IgbGlicmFyeSB1c2FnZS4nO1xyXG4gICAgbmdjQ1NWUGFyc2VyRXJyb3IuY29kZSA9IDQwNDtcclxuICAgIG9ic2VydmVyLmVycm9yKG5nY0NTVlBhcnNlckVycm9yKTtcclxuICB9XHJcblxyXG4gIGJhZENTVkRhdGFGb3JtYXRFcnJvckhhbmRsZXIob2JzZXJ2ZXI6IE9ic2VydmVyPGFueT4pIHtcclxuICAgIGNvbnN0IG5nY0NTVlBhcnNlckVycm9yOiBOZ3hDU1ZQYXJzZXJFcnJvciA9IG5ldyBOZ3hDU1ZQYXJzZXJFcnJvcigpO1xyXG4gICAgbmdjQ1NWUGFyc2VyRXJyb3IudHlwZSA9ICdCQURfQ1NWX0RBVEFfRk9STUFUJztcclxuICAgIG5nY0NTVlBhcnNlckVycm9yLm1lc3NhZ2UgPSAnVW5hYmxlIHRvIHBhcnNlIENTViBGaWxlJztcclxuICAgIG5nY0NTVlBhcnNlckVycm9yLmNvZGUgPSAxO1xyXG4gICAgb2JzZXJ2ZXIuZXJyb3IobmdjQ1NWUGFyc2VyRXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgQ1NWUGFyc2VyQ29uZmlnIHtcclxuICBoZWFkZXI/OiBib29sZWFuO1xyXG4gIGRlbGltaXRlcj86IHN0cmluZztcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxufVxyXG4iXX0=